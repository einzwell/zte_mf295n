define(["knockout","jquery","underscore","service","config/config","config/menu","tooltip"],function(e,t,n,o,i,s,a){function r(){function n(){ee().isLoggedIn?o.getSMSReady({},function(e){"1"==e.sms_cmd_status_result?window.setTimeout(function(){n()},1e3):K=!0}):window.setTimeout(function(){n()},1e3)}function r(e){t("#statusItemSimStatus").attr("tipTitle","sim_status_"+e.simStatus),e.wifiStatus?0==e.deviceSize?t("#wifi_status").attr("tipTitle","wifi_status_on"):(t("#wifi_status").attr("tipTitle","wifi_num"),t("#wifi_status").attr("tipTitle2",e.deviceSize)):t("#wifi_status").attr("tipTitle","wifi_status_off"),"1"==e.battery_customer_mode?(t("#battery_level").attr("tipTitle","battery_level_protect"),t("#battery_level_alert").addClass("batteryChargingAlert")):(t("#battery_level").attr("tipTitle","battery_level"),t("#battery_level_alert").removeClass("batteryChargingAlert"))}function l(e,n,o,i){e.connectStatus(n),"ppp_connecting"==n?(e.connectStatusTrans("connecting"),e.connectStatusText(t.i18n.prop("connecting"))):checkConnectedStatus(n)?(e.connectStatusTrans("connected"),e.connectStatusText(t.i18n.prop("connected"))):"ppp_disconnecting"==n?(e.connectStatusTrans("disconnecting"),e.connectStatusText(t.i18n.prop("disconnecting"))):o?"connect"==i?(e.connectStatus("wifi_connect"),e.connectStatusTrans("connected"),e.connectStatusText(t.i18n.prop("connected"))):"connecting"==i?(e.connectStatus("wifi_connecting"),e.connectStatusTrans("connecting"),e.connectStatusText(t.i18n.prop("connecting"))):(e.connectStatus("ppp_disconnected"),e.connectStatusTrans("disconnected"),e.connectStatusText(t.i18n.prop("disconnected"))):(e.connectStatusTrans("disconnected"),e.connectStatusText(t.i18n.prop("disconnected")))}function _(){var e=5,t=1;i.dbMsgs&&0!=i.dbMsgs.length||(e=500,t=10),o.getSMSMessages({page:0,smsCount:e,nMessageStoreType:1,tags:t,orderBy:"order by id desc"},function(e){e&&e.messages&&d(e.messages),J=!1})}W=t("#battery_temp_low"),Y=t("#battery_temp_high"),window.setTimeout(function(){function s(e){o.getSmsCapability({},function(n){var o=!1;0!=n.nvTotal&&n.nvUsed>=n.nvTotal?(t("#sms_unread_count").attr("tipTitle","sms_capacity_is_full"),o=!0):0!=n.nvTotal&&n.nvUsed+5>=n.nvTotal?(t("#sms_unread_count").attr("tipTitle","sms_capacity_will_full"),o=!0):t("#sms_unread_count").attr("tipTitle","sms_unread_count"),a.showSmsDeleteConfirm(o),void 0!==e&&a.smsUnreadCount(e),q=!0})}var a=new c;e.applyBindings(a,t("#statusBar")[0]),window.setInterval(function(){var e=ee(),n=t("#h_ssid");e.wifiStatus?n.show():n.hide(),n.html(t.i18n.prop("ssid_title")+":"+e.ssid),a.OTAStatus(e.new_version_state),a.isShowConnectionIcon("CPE"!=i.PRODUCT_TYPE||f(e.opms_wan_mode,e.opms_wan_auto_mode)),a.networkType(getNetworkType(e.networkType,e.isCaStatus)),a.signalCssClass(w(e.signalImg,e.networkType,e.simStatus));var o=!!e.roamingStatus;a.networkOperator(u(e.spn_b1_flag,e.spn_name_data,e.spn_b2_flag,e.networkOperator,o)),a.roamingStatus(e.roamingStatus?"R":""),a.wifiStatusImg(v(e.wifiStatus,e.attachedDevices.length)),a.wifiStatusCssClass(S(e.wifiStatus,e.attachedDevices.length)),a.simStatus(T(e.simStatus)),a.batteryPers(y(e.battery_value,e.batteryStatus)),a.batteryLevel(e.battery_value+"%"),k(e.mode_main_state,e.battery_temp),a.pinStatus(e.pinStatus),a.batteryStatus(e.batteryStatus),a.attachedDevices(e.attachedDevices.length),a.showAttachedDevices(e.wifiStatus),a.isLoggedIn(e.isLoggedIn),i.HAS_SMS&&K&&!b(e.simStatus)&&(!q&&e.isLoggedIn?s(e.smsUnreadCount):a.smsUnreadCount(e.smsUnreadCount)),h(a,e.opms_wan_mode,e.opms_wan_auto_mode,e.dhcp_wan_status,e.connectStatus,e.data_counter,e.connectWifiSSID,e.connectWifiStatus),l(a,e.connectStatus,e.connectWifiSSID,e.connectWifiStatus),checkTrafficLimitAlert(a,e),r({simStatus:e.simStatus,wifiStatus:e.wifiStatus,deviceSize:e.attachedDevices.length,networkType:e.networkType,battery_customer_mode:e.battery_customer_mode}),a.wifi_5g_enable(e.wifi_5g_enable),U(a.wifi_5g_enable());var c=t("#langLogoBar");e.isLoggedIn?(c.hasClass("langborderBg")||c.addClass("langborderBg"),t("#statusBar:hidden").show()):(c.hasClass("langborderBg")&&c.removeClass("langborderBg"),t("#statusBar:visible").hide()),"AUTO"==e.opms_wan_mode&&void 0!==$&&""!=$&&""!=e.opms_wan_auto_mode&&$!=e.opms_wan_auto_mode&&($=e.opms_wan_auto_mode,window.location.reload())},500),i.HAS_SMS&&(window.setInterval(function(){a.isLoggedIn()&&s()},1e4),n()),window.setInterval(function(){if(1==a.isLoggedIn()&&!t("#progress").is(":visible")){var e=ee();"connecting_server"!=e.current_upgrade_state&&"upgrading"!=e.current_upgrade_state&&"accept"!=e.current_upgrade_state&&"connect_server_success"!=e.current_upgrade_state||(null==Q?(e.is_mandatory||t.modal.close(),P()):0==Q&&(Q=null))}},1e3);var d=function(){if("FOTA"==i.UPGRADE_TYPE||"OTA"==i.UPGRADE_TYPE){var e=o.getStatusInfo();!e.isLoggedIn||0!=i.HAS_GDPR&&"1"!=e.privacy_read_flag?window.setTimeout(d,1e3):o.getUpgradeResult({},function(e){"success"==e.upgrade_result?C(!0):"fail"==e.upgrade_result?C(!1):window.setTimeout(d,1e3)},function(){window.setTimeout(d,1e3)})}};d(),"TWO_PORTION"==i.UPGRADE_TYPE&&window.setInterval(function(){var e=ee();checkConnectedStatus(e.connectStatus)&&e.isLoggedIn&&(i.ALREADY_NOTICE||o.getUpdateInfoWarning({},function(e){2==e.upgrade_notice_flag&&(i.ALREADY_NOTICE=!0,showAlert("update_notice"))}))},6e4);var _=window.setInterval(function(){if(!i.ALREADY_OTA_NOTICE&&i.HAS_OTA_NEW_VERSION&&(X>3&&window.clearInterval(_),X++,checkConnectedStatus(a.connectStatus()))){window.clearInterval(_),i.ALREADY_OTA_NOTICE=!0;var e=ee();e.is_mandatory||E(e)}},1e3)},1200),a.init(),checkTrafficLimitAlert=function(e,n){if("#login"==window.location.hash)return!1;var s=i.AP_STATION_SUPPORT?o.getStatusInfo().ap_station_enable:"undefined";if(i.AP_STATION_SUPPORT&&(void 0===s||""===s))return o.refreshAPStationStatus({},t.noop()),!1;s=1==s;var a=t("#confirm-container:visible").length>0,r="CPE"==i.PRODUCT_TYPE&&("PPP"!=n.opms_wan_mode&&("AUTO"!=n.opms_wan_mode||"AUTO_LTE_GATEWAY"!=n.opms_wan_auto_mode));if(!n.isLoggedIn||a||z&&G||!n.limitVolumeEnable||!s&&!checkConnectedStatus(n.connectStatus)||r)return!1;if(F)return window.setTimeout(function(){F=!1},2e3),!1;var c=x(n);if(c.showConfirm&&(0==i.HAS_GDPR||"1"==n.privacy_read_flag)){var u=null;c.usedPercent>100&&!G?(z=G=!0,u={msg:s?"traffic_beyond_msg":"traffic_beyond_disconnect_msg"}):z||(z=!0,G=!1,u={msg:s?"traffic_limit_msg":"traffic_limit_disconnect_msg",params:[c.limitPercent]}),null!=u&&(s?showAlert(u):showConfirm(u,function(){showLoading("disconnecting"),o.disconnect({},function(e){e.result?successOverlay():errorOverlay()})}))}},getNetworkType=function(e){var n=e.toLowerCase();return""!=n&&"limited service"!=n||(n="limited_service"),"no service"==n&&(n="no_service"),"limited_service"==n||"no_service"==n?(t("#networkType","#statusBar").attr("data-trans","network_type_"+n),t.i18n.prop("network_type_"+n)):(t("#networkType","#statusBar").removeAttr("data-trans"),e)},i.HAS_SMS&&s.checkIsMenuExist("sms/smslist")&&(window.setInterval(function(){var e=ee();if("#login"!=window.location.hash&&!b(e.simStatus)){for(key in V){var n=V[key];if(t.now()-n>5e3){delete V["m"+n];t(".bubbleItem#m"+n,"#buttom-bubble").fadeOut(1e3,function(){t(this).remove()})}}e.isLoggedIn&&(e.newSmsReceived&&!J&&(J=!0,o.resetNewSmsReceivedVar(),_()),e.smsReportReceived&&(o.resetSmsReportReceivedVar(),m()))}},1e3),i.SMS_DATABASE_SORT_SUPPORT&&window.setInterval(function(){if(s.checkIsMenuExist("sms/smslist")){var e=ee();e.isLoggedIn&&K&&!J&&!b(e.simStatus)&&(J=!0,_())}},20001)),i.HAS_SMS&&(t(".bubbleItem","#buttom-bubble").live("mouseover",function(){var e=t(this);delete V[e.attr("id")]}).live("mouseout",function(){var e=t(this),n=t.now();V["m"+n]=n,e.attr("id","m"+n),t(".bubbleItem h3 a.bubbleCloseBtn","#buttom-bubble").data("targetid","m"+n)}),t(".bubbleItem h3 a.bubbleCloseBtn","#buttom-bubble").die().live("click",function(){var e=t(this).data("targetid");delete V[e],t(".bubbleItem#"+e,"#buttom-bubble").fadeOut(1e3,function(){t(this).remove()})}))}function c(){var n=this,s=ee(),a=t("#h_ssid");s.wifiStatus?a.show():a.hide(),a.html(t.i18n.prop("ssid_title")+":"+s.ssid),$=s.opms_wan_auto_mode,n.OTAStatus=e.observable(s.new_version_state),n.isShowConnectionIcon=e.observable(!1),n.hasWifi=e.observable(i.HAS_WIFI),n.hasBattery=e.observable(i.HAS_BATTERY),n.networkType=e.observable(getNetworkType(s.networkType,s.isCaStatus)),n.signalCssClass=e.observable(w(s.signalImg,s.networkType,s.simStatus));var r=!!s.roamingStatus;n.networkOperator=e.observable(u(s.spn_b1_flag,s.spn_name_data,s.spn_b2_flag,s.networkOperator,r)),n.roamingStatus=e.observable(s.roamingStatus?"R":""),n.wifiStatusImg=e.observable(v(s.wifiStatus,s.attachedDevices.length)),n.wifiStatusCssClass=e.observable(S(s.wifiStatus,s.attachedDevices.length)),n.simStatus=e.observable(T(s.simStatus)),n.pinStatus=e.observable(s.pinStatus),n.pinStatusText=e.observable(),n.batteryStatus=e.observable(s.batteryStatus),n.batteryPers=e.observable(y(s.battery_value,s.batteryStatus)),n.batteryLevel=e.observable(s.battery_value+"%"),k(s.mode_main_state,s.battery_temp),n.connectStatus=e.observable(s.connectStatus),n.connectStatusText=e.observable(),n.connectStatusTrans=e.observable(),n.attachedDevices=e.observable(s.attachedDevices.length),n.showAttachedDevices=e.observable(s.wifiStatus),n.isLoggedIn=e.observable(s.isLoggedIn),n.showSmsDeleteConfirm=e.observable(!1),n.smsUnreadCount=e.observable(0),n.connectionCssClass=e.observable(""),h(n,s.opms_wan_mode,s.opms_wan_auto_mode,s.dhcp_wan_status,s.connectStatus,s.data_counter,s.connectWifiSSID,s.connectWifiStatus),n.wifi_5g_enable=e.observable(s.wifi_5g_enable),U(n.wifi_5g_enable());var c=t("#langLogoBar");s.isLoggedIn?(c.hasClass("langborderBg")||c.addClass("langborderBg"),t("#statusBar:hidden").show()):(c.hasClass("langborderBg")&&c.removeClass("langborderBg"),t("#statusBar:visible").hide()),n.connect=function(){showLoading("connecting"),o.connect({},function(e){e.result&&refreshConnectStatus(n,e.status),successOverlay()},function(e){errorOverlay()})},n.disconnect=function(){showLoading("disconnecting"),o.disconnect({},function(e){e.result&&refreshConnectStatus(n,e.status),successOverlay()},function(e){errorOverlay()})}}function u(e,t,n,o,i){return""==t?o:(t=decodeMessage(t),"1"==e&&"1"==n?i?o:t==o?o:t+"  "+o:"1"==e?t==o?o:t+"  "+o:"1"==n?i?o:t:"0"==e&&"0"==n?i?t==o?o:t+"  "+o:t:"")}function d(e){i.dbMsgs||(i.dbMsgs=[]),0==te.length&&t.each(i.dbMsgs,function(e,t){te.push(t.id)}),t.each(e,function(e,n){if(-1==t.inArray(n.id,te))te.push(n.id),i.dbMsgs.push(n),"1"==n.tag&&_(n,!1);else for(var o=0;o<i.dbMsgs.length;o++)if(i.dbMsgs[o].id==n.id&&i.dbMsgs[o].content!=n.content&&"1"==n.tag){i.dbMsgs[o].content=n.content,_(n,!0);break}}),i.listMsgs=l(i.dbMsgs)}function l(e){var o={},s=[];return i.listMsgs=[],groupDrafts=[],t.each(e,function(e,t){if("4"==t.tag&&""!=t.groupId)return void groupDrafts.push(t);t.target=t.number,parseInt(t.id,10)>i.smsMaxId&&(i.smsMaxId=t.id);var n=getLast8Number(t.number);n in o?o[n].push(t):(o[n]=[t],s.push(t))}),s=n.sortBy(s,function(e){return 0-parseInt(e.id+"",10)}),t.each(s,function(e,t){for(var n=getLast8Number(t.number),s=0,a=!1,r=0;r<o[n].length;r++)o[n][r].isNew&&s++,"4"==o[n][r].tag&&""==o[n][r].groupId&&(a=!0);i.listMsgs.push({id:o[n][0].id,name:"",number:o[n][0].number,latestId:o[n][0].id,totalCount:o[n].length,newCount:s,latestSms:o[n][0].content,latestTime:o[n][0].time,checked:!1,itemId:getLast8Number(n),groupId:o[n][0].groupId,hasDraft:a})}),i.listMsgs}function _(e,n){i.smsMaxId=e.id;var s=t.now();V["m"+s]=s;var a=e.number;ne&&i.phonebook&&0==i.phonebook.length&&(ne=!1,i.HAS_PHONEBOOK?p():i.phonebook=[]);for(_ in i.phonebook)if(getLast8Number(i.phonebook[_].pbm_number)==getLast8Number(e.number)){a=i.phonebook[_].pbm_name;break}var r={mark:"m"+s,name:a,title:t.i18n.prop("sms"),titleTrans:"sms",tag:e.tag,content:e.content,datetime:e.time};if(null==oe&&(oe=t.template("newMessagePopTmpl",t("#newMessagePopTmpl"))),t(".bubbleItem:not(.report)","#buttom-bubble").remove(),t.tmpl("newMessagePopTmpl",r).appendTo("#buttom-bubble"),"#sms"==window.location.hash||"#smslist"==window.location.hash){var c=i.currentChatObject&&i.currentChatObject==getLast8Number(e.number),u=getLast8Number(e.number),d=t("#smslist-item-"+u),l="";if(d&&d.length>0){for(var _=0;i.listMsgs&&_<i.listMsgs.length;_++)if(getLast8Number(i.listMsgs[_].number)==getLast8Number(e.number)){i.listMsgs[_].id=e.id,i.listMsgs[_].latestId=e.id,i.listMsgs[_].latestSms=e.content,i.listMsgs[_].latestTime=e.time,n||(i.listMsgs[_].newCount++,i.listMsgs[_].totalCount++),l=HTMLEncode(e.content);break}if(d.find(".smslist-item-checkbox p.checkbox").attr("id",e.id),d.find(".smslist-item-checkbox input:checkbox").val(e.id).attr("id","checkbox"+e.id),!n){var m=d.find(".smslist-item-total-count").text();if(m=Number(m.substring(1,m.length-1)),d.find(".smslist-item-total-count").text("("+(m+1)+")"),!i.currentChatObject||i.currentChatObject!=getLast8Number(e.number)){var f=d.find(".smslist-item-new-count").removeClass("hide");f&&f.text().length>0?f.text(Number(f.text())+1):(f.text(1),d.hasClass("font-weight-bold")||d.addClass("font-weight-bold"),d.find(".cursorhand").attr("title",l),d.find(".sms-table-content").html(l))}}var g=d.find(".smslist-item-msg span").text(e.content);g.closest("td").prop("title",e.content),i.currentChatObject&&i.currentChatObject==getLast8Number(e.number)?g.closest("tr").removeClass("font-weight-bold"):g.closest("tr").addClass("font-weight-bold"),d.find(".smslist-item-repeat span").die().click(function(){forwardClickHandler(e.id)}),d.find("span.clock-time").text(e.time);var w=d;d.hide().remove(),t("#smslist-table").prepend(w.show())}else{var b="";if(i.phonebook&&i.phonebook.length>0)for(_ in i.phonebook)if(getLast8Number(i.phonebook[_].pbm_number)==getLast8Number(e.number)){b=i.phonebook[_].pbm_name;break}var h={id:e.id,name:b,number:e.number,latestId:e.id,totalCount:1,newCount:c?0:1,latestSms:e.content,latestTime:e.time,checked:!1,hasDraft:!1,itemId:getLast8Number(e.number)};null==Z&&(Z=t.template("smsTableTmpl",t("#smsTableTmpl"))),t.tmpl("smsTableTmpl",{data:[h]}).prependTo("#smslist-table")}if(i.HAS_PHONEBOOK?t(".sms-add-contact-icon").removeClass("hide"):t(".sms-add-contact-icon").addClass("hide"),c){var v=t("#talk-item-"+e.id,"#chatlist");v&&v.length>0?(t(".J_content pre",v).html(dealContent(e.content)),t(".time .smslist-item-time",v).text(e.time),t(".smslist-item-repeat",v).die().click(function(){forwardClickHandler(e.id)}),t(".smslist-item-delete",v).die().click(function(){deleteSingleItemClickHandler(e.id)})):(t("#smsOtherTmpl").tmpl(e).appendTo("#chatlist"),t(".clear-container","#chatpanel").animate({scrollTop:t("#chatlist").height()})),i.SMS_SET_READ_WHEN_COMPLETE?i.SMS_SET_READ_WHEN_COMPLETE&&e.receivedAll&&o.setSmsRead({ids:[e.id]},t.noop):o.setSmsRead({ids:[e.id]},t.noop)}enableCheckbox(t("#smslist-checkAll"))}}function m(){ne&&i.phonebook&&0==i.phonebook.length&&(ne=!1,i.HAS_PHONEBOOK?p():i.phonebook=[]),o.getSMSDeliveryReport({page:0,smsCount:10},function(e){var n=e.messages,o=[];t.each(n,function(e,n){-1==t.inArray(n.number,o)&&(o.push(n.number),window.setTimeout(function(){var o=t.now();V["m"+o]=o,n.name=n.number;for(e in i.phonebook)if(getLast8Number(i.phonebook[e].pbm_number)==getLast8Number(n.number)){n.name=i.phonebook[e].pbm_name;break}var s=t.i18n.prop("sms_delivery_report_"+n.content),a={mark:"m"+o,name:n.name,title:t.i18n.prop("sms_report"),titleTrans:"sms_report",content:s,datetime:n.time,report:"report"};null==oe&&(oe=t.template("newMessagePopTmpl",t("#newMessagePopTmpl"))),t(".report","#buttom-bubble").remove(),t.tmpl("newMessagePopTmpl",a).appendTo("#buttom-bubble")},100))})},function(){})}function p(){g(o.getPhoneBooks({page:0,data_per_page:2e3,orderBy:"id",isAsc:!1}))}function f(e,t){return"AUTO"!=e?"STATIC"!=e&&"DHCP"!=e:"AUTO_DHCP"!=t}function g(e){t.isArray(e.pbm_data)&&e.pbm_data.length>0&&(i.phonebook=e.pbm_data)}function w(e,t,n){return t=t.toLowerCase(),n=n?n.toLowerCase():"",""!=t&&"limited_service"!=t&&"no_service"!=t&&"limited service"!=t&&"no service"!=t&&"modem_init_complete"==n||(e="_none"),"signal signal"+e}function b(e){return"modem_sim_undetected"==e||"modem_undetected"==e||"modem_sim_destroy"==e||"modem_waitpin"==e||"modem_waitpuk"==e||"modem_imsi_waitnck"==e}function h(e,t,n,i,s,a,r,c){var u="icon_connection ";if("AUTO"==t&&"AUTO_DHCP"==n)u+="1"==i?"connectionNone":"disconnect";else if("ppp_disconnected"==s){if(r&&"connect"==c)return void o.getHotspotList({},function(t){for(var n="icon_connection ",o="connecting ",i=0,s=t.hotspotList.length;i<s;i++)if("1"==t.hotspotList[i].connectStatus){o="wifi_connected";break}n+=o,e.connectionCssClass(n)});u+=r&&"connecting"==c?"connecting":"disconnect"}else"ppp_connecting"==s||"wifi_connecting"==s?u+="connecting":checkConnectedStatus(s)?"0"!=a.uploadRate&&"0"!=a.downloadRate?u+="connectionBoth":"0"!=a.uploadRate&&"0"==a.downloadRate?u+="connectionUp":"0"==a.uploadRate&&"0"!=a.downloadRate?u+="connectionDown":u+="connectionNone":u+="disconnect";e.connectionCssClass(u)}function v(e,t){return e?0==t?"./img/wifi0.png":"./img/wifi"+t+".png":"./img/wifi_off.png"}function S(e,t){return e?0==t?"wifi_status0":"wifi_status"+t:"wifi_status_off"}function T(e){var t;switch(e){case"modem_init_complete":t="./img/ic_indicator_sd.png";break;case"modem_waitpin":case"modem_waitpuk":case"modem_sim_undetected":case"modem_undetected":case"modem_imsi_waitnck":case"modem_sim_destroy":case"modem_destroy":t="./img/ic_indicator_sim_undetected.png";break;default:t="./img/ic_indicator_sd.png"}return t}function y(e,t){var n=parseInt(e);return"0"==t?n>=0&&n<=5?"img/battery_out.png":n>5&&n<=25?"img/battery_one.png":n>25&&n<=50?"img/battery_two.png":n>50&&n<100?"img/battery_three.png":"img/battery_full.png":"2"==t?"img/battery_full.png":"img/battery_charging.gif"}function k(e,t){"mode_power_on_charger"==e&&t<=0?(W.show(),Y.hide()):"mode_power_on_charger"==e&&t>=50?(W.hide(),Y.show()):(W.hide(),Y.hide())}function C(e){if(t("#loading").is(":visible")||t("#confirm").is(":visible"))window.setTimeout(function(){C(e)},1e3);else{var n=e?"ota_update_success":"ota_update_failed";showAlert(n,function(){"OTA"==i.UPGRADE_TYPE&&o.clearUpdateResult({},t.noop())})}}function I(){"low_battery"==o.getCurrentUpgradeState().current_upgrade_state&&(showInfo("ota_low_battery"),clearInterval(ie))}function P(){function e(){var n=["upgrade_pack_redownload","upgrade_prepare_install","low_battery","connecting_server","connect_server_success","upgrading","accept"],i=o.getCurrentUpgradeState();"fota_idle"==i.current_upgrade_state.toLowerCase()?addTimeout(e,1e3):-1!=t.inArray(i.current_upgrade_state,n)&&(hideLoading(),M())}Q=!0,t("#progress").is(":visible")||e();var n=0,i=function(){var e=null;n<=3?(n+=1,e=o.getCurrentUpgradeState()):e=ee();var t=e.current_upgrade_state;if(Q){if("connecting_server"==t);else{if("connect_server_failed"==t)return Q=!1,window.clearTimeout(se),hideProgressBar(),void showAlert("ota_connect_server_failed");if("connect_server_success"==t);else if("upgrading"==t)A();else if("download_success"==t);else if("upgrade_pack_check_ok"==t);else{if("download_failed"==t)return hideProgressBar(),Q=!1,showAlert("ota_download_failed"),void window.clearTimeout(se);if("server_unavailable"==t)return hideProgressBar(),Q=!1,showAlert("ota_connect_server_failed"),void window.clearTimeout(se);if("network_unavailable"==t)return hideProgressBar(),Q=!1,showAlert("ota_no_network"),void window.clearTimeout(se);if("pkg_exceed"==t)return hideProgressBar(),Q=!1,showAlert("ota_pkg_exceed"),void window.clearTimeout(se);if("accept"==t);else{if("low_battery"==t)return hideProgressBar(),Q=!1,showInfo("ota_low_battery"),void window.clearTimeout(se);if("upgrade_pack_error"==t)return hideProgressBar(),Q=!1,showInfo("ota_md5_error"),void window.clearTimeout(se);if("upgrade_prepare_install"==t)return hideProgressBar(),Q=!1,o.removeTimerThings("current_upgrade_state",function(){}),showInfo("ota_download_success"),window.clearTimeout(se),void(ie=setInterval(function(){I()},1e3));if("checking"==t||"fota_idle"==t);else if("upgrade_pack_redownload"!=t)return Q=!1,hideProgressBar(),void window.clearTimeout(se)}}}se=window.setTimeout(i,1e3)}};Q?se=window.setTimeout(i,100):window.clearTimeout(se)}function O(e){var t=o.getUserChoice();if(e){var n=ee();if(!checkConnectedStatus(n.connectStatus)&&"connect"!=n.connectWifiStatus)return void showAlert("ota_network_disconnected");"none"==t.if_has_select?L():"accept"==t.if_has_select?P():"cancel"==t.if_has_select?showAlert("ota_have_cancel"):"downloading_cancel"==t.if_has_select&&showAlert("ota_have_cancel")}else"none"==t.if_has_select?N():"accept"==t.if_has_select?P():"cancel"==t.if_has_select||t.if_has_select}function A(){o.getPackSizeInfo({},function(e){var n;n=0==parseInt(e.pack_total_size)?0:parseInt(100*parseInt(e.download_size)/parseInt(e.pack_total_size)),n>100&&(n=100),n>0&&(n>95&&showProgressBar("ota_update","<br/>"+t.i18n.prop("ota_update_warning")),setProgressBar(n))})}function L(){o.setUpgradeSelectOp({selectOp:"1"},function(e){"success"==e.result&&P()})}function N(){o.setUpgradeSelectOp({selectOp:"0"},function(e){})}function M(){if(o.getMandatory().is_mandatory)showProgressBar("ota_update","<br/>"+t.i18n.prop("ota_update_warning"));else{var e="";"OTA"==i.UPGRADE_TYPE&&(e="<br/><br/><button id='btnStopUpgrade' onclick='stopOTAUpgrade();' class='btn-1 btn-primary'>"+t.i18n.prop("cancel")+"</button>"),showProgressBar("ota_update","<br/>"+t.i18n.prop("ota_update_warning")+e)}setProgressBar(0)}function E(e){var n=e.current_upgrade_state;if("upgrade_pack_redownload"==n)showConfirm("ota_interrupted",{ok:function(){O(1)},no:function(){O(0)}});else{var i=["upgrade_prepare_install","low_battery","connecting_server","connect_server_success","upgrading","accept"];if(-1!=t.inArray(n,i))P();else{var s=o.getNewVersionInfo(),a="";s.dm_new_version&&(a="<br/>"+t.i18n.prop("ota_version")+s.dm_new_version),showConfirm(t.i18n.prop("ota_new_version")+a,{ok:function(){O(1)},no:function(){O(0)}})}}}function R(e){z=!!e,G=!!e,e||(F=!0)}function B(e){G=!!e,e||(F=!0)}function x(e){var t={showConfirm:!1,limitPercent:e.limitVolumePercent};if("1"==e.limitVolumeType){var n=parseInt(e.data_counter.monthlySent,10)+parseInt(e.data_counter.monthlyReceived,10);t.usedPercent=n/e.limitVolumeSize*100,t.usedPercent>t.limitPercent&&(t.showConfirm=!0,t.type="data")}else t.usedPercent=e.data_counter.monthlyConnectedTime/e.limitVolumeSize*100,t.usedPercent>t.limitPercent&&(t.showConfirm=!0,t.type="time");return t}function U(e){function t(){var e=o.getStatusInfo();"0"==e.radio_off||"1"==e.radio_off?successOverlay():n<=20?(n+=1,addTimeout(function(){t()},2e3)):successOverlay()}if("0"==e){var n=0;o.getWifiAdvance({},function(e){if("a"==e.wifiBand){var n={};n.name="wifi_5g_enable",n.value="1",o.setNV(n,function(){showConfirm("wifi_5g_enalbe_alert",function(){showLoading(),o.setWifiBand({wifiEnabled:"1",wifi_band:"b"},function(e){"success"==e.result?setTimeout(function(){t()},2e3):errorOverlay()})})})}})}}function D(){var e=window.location.href;if(-1!=e.indexOf("?no_connect")){var t=o.getStatusInfo();"PPPOE"==t.opms_wan_mode||"AUTO"==t.opms_wan_mode&&"AUTO_PPPOE"==t.opms_wan_auto_mode?window.location.href=e.slice(0,e.indexOf("?no_connect"))+"#net_setting":window.location.href=e.slice(0,e.indexOf("?no_connect"))+"#home"}else-1!=e.indexOf("?flow_beyond")?window.location.href=e.slice(0,e.indexOf("?flow_beyond"))+"#traffic_alert":-1!=e.indexOf("?fota_upgrade")?window.location.href=e.slice(0,e.indexOf("?fota_upgrade"))+"#ota_update":window.location.hash="#home"}function H(){if("#login"!=window.location.hash){var e=window.location.href;window.location.href=e.slice(0,e.indexOf("?no_connect"))+"#home"}}function j(e){var t=o.getStatusInfo(),n=window.location.href;-1!=window.location.href.indexOf("?no_connect")?"PPPOE"==t.opms_wan_mode||"AUTO"==t.opms_wan_mode&&"AUTO_PPPOE"==t.opms_wan_auto_mode?e?showPromptNoImg("pppoe_error_jump_login",function(){window.location.href=n.slice(0,n.indexOf("?no_connect"))+"#net_setting"}):showPromptNoImg("pppoe_error_jump"):"modem_init_complete"==t.simStatus?"0"==t.ppp_dial_conn_fail_counter||""==t.ppp_dial_conn_fail_counter?e?showPromptNoImg("no_connect_jump_login",function(){H()}):showPromptNoImg("no_connect_jump"):e?showPromptNoImg("connect_failed_jump_login",function(){H()}):showPromptNoImg("connect_failed_jump"):"modem_sim_undetected"==t.simStatus?showPromptNoImg("no_simcard_jump",function(){H()}):"modem_sim_destroy"==t.simStatus||"modem_destroy"==t.simStatus?showPromptNoImg("invalid_simcard_jump",function(){H()}):"modem_imsi_waitnck"==t.simStatus||"modem_waitpin"==t.simStatus||"modem_waitpuk"==t.simStatus?e?showPromptNoImg("locked_simcard_jump_login",function(){H()}):showPromptNoImg("locked_simcard_jump"):e?showPromptNoImg("connect_failed_jump_login",function(){H()}):showPromptNoImg("connect_failed_jump"):-1!=window.location.href.indexOf("?flow_beyond")?e?showPromptNoImg("flow_beyond_jump_login",function(){o.setRedirectOff(),window.location.href=n.slice(0,n.indexOf("?flow_beyond"))+"#traffic_alert"}):showPromptNoImg("flow_beyond_jump",function(){o.setRedirectOff()}):-1!=window.location.href.indexOf("?fota_upgrade")&&(e?showPromptNoImg("fota_upgrade_jump_login",function(){o.setRedirectOff(),window.location.href=n.slice(0,n.indexOf("?fota_upgrade"))+"#ota_update"}):showPromptNoImg("fota_upgrade_jump",function(){o.setRedirectOff()}))}var W,Y,V={},z=!1,G=!1,F=!1,K=!1,q=!1,J=!1,Q=null,X=0,Z=null,$="",ee=function(){return o.getStatusInfo()},te=[],ne=!0,oe=null;gotoSmsList=function(){var e="#sms";"#sms"==window.location.hash&&(e="#smslist"),checkFormContentModify(e)&&(window.location.hash=e)};var ie=0,se=0;return showOTAAlert=function(){if(o.getMandatory().is_mandatory)P();else{var e={};e=o.getCurrentUpgradeState(),E(e)}},stopOTAUpgrade=function(){o.setUpgradeSelectOp({selectOp:"2"},function(e){}),Q=!1,window.clearTimeout(se),hideLoading(),showAlert("ota_cancel")},{init:r,setTrafficAlertPopuped:R,setTrafficAlert100Popuped:B,getTrafficResult:x,showOTAAlert:showOTAAlert,gotoRelevantHashByFlag:D,setRedirectTips:j}});
//# sourceMappingURL=../../sourcemaps/status/statusBar.js.map
